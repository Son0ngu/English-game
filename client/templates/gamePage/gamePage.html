<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Battle Game</title>
    <link rel="stylesheet" href="gamePage.css">
</head>
<body>
    <div class="game-container">
        <!-- Timer display in top-right corner -->
        <div class="timer-display" id="timerDisplay" style="display: none;">
            Time: 30
        </div>
        
        <div class="loading-screen" id="loadingScreen">
            <div class="loading-text">Loading game...</div>
        </div>
        
        <div class="battle-scene" id="battleScene" style="display: none;">
            <!-- Health bars -->
            <div class="health-bars">
                <div class="player-stats">
                    <div class="health-bar">
                        <div class="health-bar-fill player-health" style="width: 0%"></div>
                        <span class="health-text">0</span>
                    </div>
                    <div class="player-level">Level: <span id="playerLevel">-</span></div>
                </div>
                <div class="monster-stats">
                    <div class="health-bar">
                        <div class="health-bar-fill monster-health" style="width: 0%"></div>
                        <span class="health-text">0</span>
                    </div>
                    <div class="monster-level">Level: <span id="monsterLevel">-</span></div>
                </div>
            </div>
            
            <!-- Battle characters -->
            <div class="battle-characters">
                <div class="player">
                    <img src="../../static/images/player.png" alt="Player character">
                </div>
                <div class="damage-number" id="damageNumber" style="opacity: 0;">0</div>
                <div class="attack-effect" id="attackEffect" style="opacity: 0;"></div>
                <div class="monster">
                    <img src="../../static/images/monster.png" alt="Monster">
                </div>
            </div>
        </div>
        
        <!-- Question area - positioned at bottom -->
        <div class="question-area" id="questionArea" style="display: none;">
            <div class="question">
                <div class="question-text" id="questionText">Loading question...</div>
            </div>
            
            <!-- Multiple choice answers -->
            <div class="answers" id="answersContainer">
                <button class="answer-btn" style="display: none;"></button>
                <button class="answer-btn" style="display: none;"></button>
                <button class="answer-btn" style="display: none;"></button>
                <button class="answer-btn" style="display: none;"></button>
            </div>

            <!-- Fill in the blank questions -->
            <div class="question-type fill-in-blank" id="fillInBlankQuestion" style="display: none;">
                <div class="question">
                    <div class="question-text" id="fillInBlankText">Complete the sentence:</div>
                    <div class="sentence-container">
                        <span class="sentence-part" id="sentenceBefore">I went to the</span>
                        <input type="text" class="blank-input" id="blankInput" placeholder="____" autocomplete="off">
                        <span class="sentence-part" id="sentenceAfter">yesterday.</span>
                    </div>
                    <div class="hint-text" id="hintText" style="display: none;">
                        Hint: A place where you can buy things
                    </div>
                </div>
                <div class="fill-controls">
                    <button class="submit-answer-btn" id="submitAnswerBtn">Submit Answer</button>
                    <button class="show-hint-btn" id="showHintBtn" style="display: none;">Show Hint</button>
                    <button class="clear-btn" id="clearBtn">Clear</button>
                </div>
                <div class="feedback-area" id="feedbackArea" style="display: none;">
                    <div class="feedback-text" id="feedbackText"></div>
                    <button class="next-question-btn" id="nextQuestionBtn" style="display: none;">Next Question</button>
                </div>
            </div>
        </div>

        <!-- Game info display -->
        <div class="game-info" id="gameInfo" style="display: none;">
            <div class="difficulty">Difficulty: <span id="gameDifficulty">-</span></div>
            <div class="session">Session: <span id="sessionId">-</span></div>
        </div>

        <!-- Error message -->
        <div class="error-message" id="errorMessage" style="display: none;">
            <p>Failed to load game. Please refresh the page or try again later.</p>
            <button onclick="location.reload()">Retry</button>
        </div>
    </div>

    <!-- Audio SFX -->
    <audio id="sfx-attack">
        <source src="../../static/music/attack.wav" type="audio/wav">
    </audio>
    <audio id="sfx-hit">
        <source src="../../static/music/hit.wav" type="audio/wav">
    </audio>

    <script src="gamePage.js"></script>
    <script>
        // Global audio functions
        function playAttackSFX() {
            const sfx = document.getElementById('sfx-attack');
            if (sfx) {
                sfx.currentTime = 0;
                sfx.play().catch(e => console.log('Audio play failed:', e));
            }
        }

        function playHitSFX() {
            const sfx = document.getElementById('sfx-hit');
            if (sfx) {
                sfx.currentTime = 0;
                sfx.play().catch(e => console.log('Audio play failed:', e));
            }
        }

        // Show/hide game sections
        function showLoadingScreen() {
            document.getElementById('loadingScreen').style.display = 'block';
            document.getElementById('battleScene').style.display = 'none';
            document.getElementById('questionArea').style.display = 'none';
            document.getElementById('gameInfo').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('timerDisplay').style.display = 'none';
        }

        function showGameScreen() {
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('battleScene').style.display = 'flex';
            document.getElementById('questionArea').style.display = 'block';
            document.getElementById('gameInfo').style.display = 'block';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('timerDisplay').style.display = 'block';
        }

        function showErrorScreen() {
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('battleScene').style.display = 'none';
            document.getElementById('questionArea').style.display = 'none';
            document.getElementById('gameInfo').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'block';
            document.getElementById('timerDisplay').style.display = 'none';
        }

        // Background music handling
        window.addEventListener("DOMContentLoaded", () => {
            const music = document.getElementById("bg-music");
            
            if (music) {
                // Play music after user interaction
                document.body.addEventListener("click", () => {
                    if (music.paused) {
                        music.volume = 0.3;
                        music.play().catch(e => console.log('Music play failed:', e));
                    }
                }, { once: true });
            }

            // Show loading screen initially
            showLoadingScreen();
        });
    </script>

    <audio id="bg-music" loop>
        <source src="/English-game/client/static/music/combat.wav" type="audio/wav">
        Your browser does not support audio.
    </audio>
</body>
</html>